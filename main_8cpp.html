<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>1-phase PV router: Mk2_fasterControl_Full/main.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">1-phase PV router
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_576a50aa5f524dfed8b859bbdd5e306e.html">Mk2_fasterControl_Full</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">main.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Main code.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="calibration_8h_source.html">calibration.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="processing_8h_source.html">processing.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="types_8h_source.html">types.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="utils_8h_source.html">utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="utils__relay_8h_source.html">utils_relay.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="utils__display_8h_source.html">utils_display.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="utils__oled_8h_source.html">utils_oled.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="utils__temp_8h_source.html">utils_temp.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="validation_8h_source.html">validation.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp__incl.png" border="0" usemap="#aMk2__fasterControl__Full_2main_8cpp" alt=""/></div>
<map name="aMk2__fasterControl__Full_2main_8cpp" id="aMk2__fasterControl__Full_2main_8cpp">
<area shape="rect" title="Main code." alt="" coords="1204,5,1376,45"/>
<area shape="rect" title=" " alt="" coords="1528,460,1612,485"/>
<area shape="rect" href="config_8h.html" title="Configuration values to be set by the end&#45;user." alt="" coords="1276,240,1349,265"/>
<area shape="rect" href="types_8h.html" title="Some basics classes/types." alt="" coords="1385,387,1456,412"/>
<area shape="rect" href="utils__relay_8h.html" title="Some utility functions for the relay output feature." alt="" coords="896,313,996,339"/>
<area shape="rect" href="utils__temp_8h.html" title="Provides utilities for managing temperature sensors." alt="" coords="1859,313,1961,339"/>
<area shape="rect" href="calibration_8h.html" title="Calibration values definition." alt="" coords="1239,167,1341,192"/>
<area shape="rect" href="processing_8h.html" title="Public functions/variables of processing engine." alt="" coords="1366,167,1470,192"/>
<area shape="rect" href="utils_8h.html" title="Some utility functions." alt="" coords="1795,93,1857,119"/>
<area shape="rect" href="utils__display_8h.html" title="7&#45;segments display functions" alt="" coords="1049,167,1163,192"/>
<area shape="rect" href="utils__oled_8h.html" title="Some utility functions for OLED display." alt="" coords="1576,313,1673,339"/>
<area shape="rect" href="validation_8h.html" title=" " alt="" coords="875,167,974,192"/>
<area shape="rect" href="config__system_8h.html" title="Basic configuration values to be set by the end&#45;user." alt="" coords="1233,387,1361,412"/>
<area shape="rect" href="debug_8h.html" title="Some macro for the Serial Output and Debugging." alt="" coords="1134,387,1209,412"/>
<area shape="rect" href="utils__dualtariff_8h.html" title="Some utility functions for dual tariff feature." alt="" coords="1373,313,1501,339"/>
<area shape="rect" href="type__traits_8hpp.html" title="Some useful but missing stl functions templates." alt="" coords="1117,460,1237,485"/>
<area shape="rect" href="conditional_8hpp.html" title=" " alt="" coords="5,541,201,566"/>
<area shape="rect" href="enable__if_8hpp.html" title=" " alt="" coords="225,533,365,573"/>
<area shape="rect" href="integral__constant_8hpp.html" title=" " alt="" coords="1407,768,1554,808"/>
<area shape="rect" href="is__array_8hpp.html" title=" " alt="" coords="389,541,564,566"/>
<area shape="rect" href="is__base__of_8hpp.html" title=" " alt="" coords="588,533,733,573"/>
<area shape="rect" href="remove__reference_8hpp.html" title=" " alt="" coords="239,621,408,647"/>
<area shape="rect" href="is__class_8hpp.html" title=" " alt="" coords="432,621,607,647"/>
<area shape="rect" href="is__const_8hpp.html" title=" " alt="" coords="1940,695,2117,720"/>
<area shape="rect" href="is__convertible_8hpp.html" title=" " alt="" coords="631,621,845,647"/>
<area shape="rect" href="is__enum_8hpp.html" title=" " alt="" coords="910,541,1089,566"/>
<area shape="rect" href="is__floating__point_8hpp.html" title=" " alt="" coords="921,621,1078,647"/>
<area shape="rect" href="is__same_8hpp.html" title=" " alt="" coords="1142,695,1246,720"/>
<area shape="rect" href="is__integral_8hpp.html" title=" " alt="" coords="1103,621,1221,647"/>
<area shape="rect" href="is__pointer_8hpp.html" title=" " alt="" coords="1518,695,1705,720"/>
<area shape="rect" href="is__signed_8hpp.html" title=" " alt="" coords="1297,621,1483,647"/>
<area shape="rect" href="is__unsigned_8hpp.html" title=" " alt="" coords="1507,621,1708,647"/>
<area shape="rect" href="make__unsigned_8hpp.html" title=" " alt="" coords="1638,541,1865,566"/>
<area shape="rect" href="make__void_8hpp.html" title=" " alt="" coords="1990,541,2185,566"/>
<area shape="rect" href="remove__const_8hpp.html" title=" " alt="" coords="2209,533,2355,573"/>
<area shape="rect" title=" " alt="" coords="139,621,214,647"/>
<area shape="rect" href="declval_8hpp.html" title=" " alt="" coords="580,695,677,720"/>
<area shape="rect" href="remove__cv_8hpp.html" title=" " alt="" coords="1271,695,1392,720"/>
<area shape="rect" href="type__identity_8hpp.html" title=" " alt="" coords="1729,695,1864,720"/>
<area shape="rect" href="constants_8h.html" title="Some constants." alt="" coords="1867,460,1964,485"/>
<area shape="rect" href="movingAvg_8h.html" title="Code for sliding&#45;window average." alt="" coords="1003,387,1110,412"/>
<area shape="rect" href="ewma__avg_8hpp.html" title="This file implements an Exponentially Weighted Moving Average template class." alt="" coords="857,387,979,412"/>
<area shape="rect" href="utils__pins_8h.html" title="Some utility functions for pins manipulation." alt="" coords="737,387,833,412"/>
<area shape="rect" title=" " alt="" coords="1771,167,1881,192"/>
<area shape="rect" href="FastDivision_8h.html" title=" " alt="" coords="1663,240,1776,265"/>
<area shape="rect" href="dualtariff_8h.html" title="Classes/types needed for dual&#45;tariff support." alt="" coords="1494,167,1587,192"/>
<area shape="rect" href="teleinfo_8h.html" title="Manages telemetry data and frame formatting." alt="" coords="1663,167,1747,192"/>
<area shape="rect" href="version_8h.html" title=" " alt="" coords="1906,167,1989,192"/>
<area shape="rect" title=" " alt="" coords="1633,387,1717,412"/>
</map>
</div>
</div>
<p><a href="main_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a31f3d562faae6b598324b56299d74f7d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a31f3d562faae6b598324b56299d74f7d">checkDiversionOnOff</a> ()</td></tr>
<tr class="memdesc:a31f3d562faae6b598324b56299d74f7d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks and updates the diversion state.  <br /></td></tr>
<tr class="separator:a31f3d562faae6b598324b56299d74f7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5157f7f79cf8c75c2d7b41d8ed47a7ef"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a5157f7f79cf8c75c2d7b41d8ed47a7ef">forceFullPower</a> ()</td></tr>
<tr class="memdesc:a5157f7f79cf8c75c2d7b41d8ed47a7ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forces all loads to full power.  <br /></td></tr>
<tr class="separator:a5157f7f79cf8c75c2d7b41d8ed47a7ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d65183fd2d4da02833f68fd000b4761"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a1d65183fd2d4da02833f68fd000b4761">handlePerSecondTasks</a> (bool &amp;bOffPeak, int16_t iTemperature_x100)</td></tr>
<tr class="memdesc:a1d65183fd2d4da02833f68fd000b4761"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles tasks that need to be executed every second.  <br /></td></tr>
<tr class="separator:a1d65183fd2d4da02833f68fd000b4761"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f">loop</a> ()</td></tr>
<tr class="memdesc:afe461d27b9c48d5921c00d521181f12f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main processor loop.  <br /></td></tr>
<tr class="separator:afe461d27b9c48d5921c00d521181f12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0f1d282805a9e6027f2a84720d60d0b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#aa0f1d282805a9e6027f2a84720d60d0b">proceedLoadPrioritiesAndOverriding</a> (const int16_t currentTemperature_x100)</td></tr>
<tr class="memdesc:aa0f1d282805a9e6027f2a84720d60d0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles load priority rotation and overriding logic.  <br /></td></tr>
<tr class="separator:aa0f1d282805a9e6027f2a84720d60d0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a518d4266a5d9285d29e65616eccd2277"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a518d4266a5d9285d29e65616eccd2277">proceedLoadPrioritiesAndOverridingDualTariff</a> (const int16_t currentTemperature_x100)</td></tr>
<tr class="memdesc:a518d4266a5d9285d29e65616eccd2277"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles load priority in combination with dual tariff.  <br /></td></tr>
<tr class="separator:a518d4266a5d9285d29e65616eccd2277"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b9428fd01019319970f27b88bb1cf33"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a9b9428fd01019319970f27b88bb1cf33">proceedRotation</a> ()</td></tr>
<tr class="memdesc:a9b9428fd01019319970f27b88bb1cf33"><td class="mdescLeft">&#160;</td><td class="mdescRight">Rotates the load priorities.  <br /></td></tr>
<tr class="separator:a9b9428fd01019319970f27b88bb1cf33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a288869292fd78ce525e6cb97a430ed02"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a288869292fd78ce525e6cb97a430ed02">processCalculationsForLogging</a> ()</td></tr>
<tr class="memdesc:a288869292fd78ce525e6cb97a430ed02"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs calculations on data for logging purposes.  <br /></td></tr>
<tr class="separator:a288869292fd78ce525e6cb97a430ed02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a> ()</td></tr>
<tr class="memdesc:a4fc01d736fe50cf5b977f755b675f11d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called once during startup.  <br /></td></tr>
<tr class="separator:a4fc01d736fe50cf5b977f755b675f11d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac4a0e0b4ad49cbbab8b2626204f9492"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#aac4a0e0b4ad49cbbab8b2626204f9492">updateTemperature</a> ()</td></tr>
<tr class="memdesc:aac4a0e0b4ad49cbbab8b2626204f9492"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the temperature readings and sends a new request for the next cycle.  <br /></td></tr>
<tr class="separator:aac4a0e0b4ad49cbbab8b2626204f9492"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main code. </p>
<dl class="section author"><dt>Author</dt><dd>Frédéric Metrich (<a href="#" onclick="location.href='mai'+'lto:'+'fre'+'de'+'ric'+'.m'+'etr'+'ic'+'h@l'+'iv'+'e.f'+'r'; return false;">frede<span class="obfuscator">.nosp@m.</span>ric.<span class="obfuscator">.nosp@m.</span>metri<span class="obfuscator">.nosp@m.</span>ch@l<span class="obfuscator">.nosp@m.</span>ive.f<span class="obfuscator">.nosp@m.</span>r</a>) </dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.1 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2024-10-03</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (c) 2024 </dd></dl>

<p class="definition">Definition in file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a31f3d562faae6b598324b56299d74f7d" name="a31f3d562faae6b598324b56299d74f7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31f3d562faae6b598324b56299d74f7d">&#9670;&#160;</a></span>checkDiversionOnOff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkDiversionOnOff </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks and updates the diversion state. </p>
<p>This function monitors the state of the diversion pin to determine whether the diversion is active or not. If the diversion pin state changes, it updates the <code>b_diversionOff</code> flag accordingly. Additionally, if debugging is enabled, it logs the state transitions (e.g., "Trigger diversion OFF!" or "End diversion OFF!") to the debug output.</p>
<dl class="section note"><dt>Note</dt><dd>This function is only executed if the <code>DIVERSION_PIN_PRESENT</code> compile-time constant is defined.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State.">getPinState</a> </dd>
<dd>
<a class="el" href="config_8h.html#a432138093c53d7580af9ec5c5dca387f">ENABLE_DEBUG</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00270">270</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a31f3d562faae6b598324b56299d74f7d_cgraph.png" border="0" usemap="#amain_8cpp_a31f3d562faae6b598324b56299d74f7d_cgraph" alt=""/></div>
<map name="amain_8cpp_a31f3d562faae6b598324b56299d74f7d_cgraph" id="amain_8cpp_a31f3d562faae6b598324b56299d74f7d_cgraph">
<area shape="rect" title="Checks and updates the diversion state." alt="" coords="5,5,164,31"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="212,5,309,31"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="357,5,432,31"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a31f3d562faae6b598324b56299d74f7d_icgraph.png" border="0" usemap="#amain_8cpp_a31f3d562faae6b598324b56299d74f7d_icgraph" alt=""/></div>
<map name="amain_8cpp_a31f3d562faae6b598324b56299d74f7d_icgraph" id="amain_8cpp_a31f3d562faae6b598324b56299d74f7d_icgraph">
<area shape="rect" title="Checks and updates the diversion state." alt="" coords="323,5,481,31"/>
<area shape="rect" href="main_8cpp.html#a1d65183fd2d4da02833f68fd000b4761" title="Handles tasks that need to be executed every second." alt="" coords="104,5,275,31"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
</map>
</div>

</div>
</div>
<a id="a5157f7f79cf8c75c2d7b41d8ed47a7ef" name="a5157f7f79cf8c75c2d7b41d8ed47a7ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5157f7f79cf8c75c2d7b41d8ed47a7ef">&#9670;&#160;</a></span>forceFullPower()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool forceFullPower </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Forces all loads to full power. </p>
<p>This function overrides the normal load control logic and forces all loads to operate at full power. It checks the state of the override pin and updates the override flags for all loads accordingly. If debugging is enabled, it logs the state transitions (e.g., "Trigger override!" or "End override!") to the debug output.</p>
<p>Key operations include:</p><ul>
<li>Checking the state of the override pin.</li>
<li>Updating the override flags for all loads.</li>
<li>Logging state transitions if debugging is enabled.</li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>true if the override is active and all loads are forced to full power. </dd>
<dd>
false if the override is not active.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function is only executed if the <code>OVERRIDE_PIN_PRESENT</code> compile-time constant is defined.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State.">getPinState</a> </dd>
<dd>
<a class="el" href="config_8h.html#a432138093c53d7580af9ec5c5dca387f">ENABLE_DEBUG</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00055">55</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a5157f7f79cf8c75c2d7b41d8ed47a7ef_cgraph.png" border="0" usemap="#amain_8cpp_a5157f7f79cf8c75c2d7b41d8ed47a7ef_cgraph" alt=""/></div>
<map name="amain_8cpp_a5157f7f79cf8c75c2d7b41d8ed47a7ef_cgraph" id="amain_8cpp_a5157f7f79cf8c75c2d7b41d8ed47a7ef_cgraph">
<area shape="rect" title="Forces all loads to full power." alt="" coords="5,5,124,31"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="172,5,269,31"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="317,5,392,31"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a5157f7f79cf8c75c2d7b41d8ed47a7ef_icgraph.png" border="0" usemap="#amain_8cpp_a5157f7f79cf8c75c2d7b41d8ed47a7ef_icgraph" alt=""/></div>
<map name="amain_8cpp_a5157f7f79cf8c75c2d7b41d8ed47a7ef_icgraph" id="amain_8cpp_a5157f7f79cf8c75c2d7b41d8ed47a7ef_icgraph">
<area shape="rect" title="Forces all loads to full power." alt="" coords="323,5,441,31"/>
<area shape="rect" href="main_8cpp.html#a1d65183fd2d4da02833f68fd000b4761" title="Handles tasks that need to be executed every second." alt="" coords="104,5,275,31"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
</map>
</div>

</div>
</div>
<a id="a1d65183fd2d4da02833f68fd000b4761" name="a1d65183fd2d4da02833f68fd000b4761"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d65183fd2d4da02833f68fd000b4761">&#9670;&#160;</a></span>handlePerSecondTasks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handlePerSecondTasks </td>
          <td>(</td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>bOffPeak</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>iTemperature_x100</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles tasks that need to be executed every second. </p>
<p>This function performs a series of operations that are executed once per second. These include updating the absence of diverted energy count, toggling the watchdog pin (if present), updating the watchdog, checking the diversion state, managing load priorities and overrides, and refreshing the display. It also handles relay operations if relay diversion is enabled.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bOffPeak</td><td>A reference to a boolean indicating whether the off-peak tariff is active. This value may be updated based on load priorities and overriding logic. </td></tr>
    <tr><td class="paramname">iTemperature_x100</td><td>The current temperature multiplied by 100 (e.g., 25.00°C is represented as 2500). Used for temperature-based logic, such as load overrides.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function relies on several compile-time constants and global variables, such as <code>WATCHDOG_PIN_PRESENT</code>, <code>RELAY_DIVERSION</code>, and <code>EDD_isIdle</code>.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="main_8cpp.html#aa0f1d282805a9e6027f2a84720d60d0b" title="Handles load priority rotation and overriding logic.">proceedLoadPrioritiesAndOverriding</a> </dd>
<dd>
<a class="el" href="main_8cpp.html#a5157f7f79cf8c75c2d7b41d8ed47a7ef" title="Forces all loads to full power.">forceFullPower</a> </dd>
<dd>
<a class="el" href="main_8cpp.html#a31f3d562faae6b598324b56299d74f7d" title="Checks and updates the diversion state.">checkDiversionOnOff</a> </dd>
<dd>
<a class="el" href="group__SegDisplay.html#gaa93cf18ded17c52a21fa1bd80ac95ac2" title="Refreshes the display by updating the active digit and its segments.">refreshDisplay</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00441">441</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a1d65183fd2d4da02833f68fd000b4761_cgraph.png" border="0" usemap="#amain_8cpp_a1d65183fd2d4da02833f68fd000b4761_cgraph" alt=""/></div>
<map name="amain_8cpp_a1d65183fd2d4da02833f68fd000b4761_cgraph" id="amain_8cpp_a1d65183fd2d4da02833f68fd000b4761_cgraph">
<area shape="rect" title="Handles tasks that need to be executed every second." alt="" coords="5,161,176,187"/>
<area shape="rect" href="main_8cpp.html#a31f3d562faae6b598324b56299d74f7d" title="Checks and updates the diversion state." alt="" coords="477,5,636,31"/>
<area shape="rect" href="main_8cpp.html#a5157f7f79cf8c75c2d7b41d8ed47a7ef" title="Forces all loads to full power." alt="" coords="497,56,616,81"/>
<area shape="rect" href="classRelayEngine.html#a4f831b566b2da140a17333ab6a39e5dc" title="Increment the duration&#39;s state of each relay." alt="" coords="224,104,415,129"/>
<area shape="rect" href="classRelayEngine.html#a2891986bc989d9c35301711f674bc523" title="Proceed all relays in increasing order (surplus) or decreasing order (import)." alt="" coords="238,154,401,194"/>
<area shape="rect" href="main_8cpp.html#aa0f1d282805a9e6027f2a84720d60d0b" title="Handles load priority rotation and overriding logic." alt="" coords="225,218,413,258"/>
<area shape="rect" href="utils__pins_8h.html#aaec5db9d46ba784c4f16046e6deb6977" title="Toggle the specified pin." alt="" coords="278,283,361,308"/>
<area shape="rect" href="group__OLEDDisplay.html#ga1c38ae281a8a132599b5619660e7d306" title="Update the watchdog on the display." alt="" coords="254,332,385,357"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="715,83,812,108"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="904,83,979,108"/>
<area shape="rect" href="main_8cpp.html#a518d4266a5d9285d29e65616eccd2277" title="Handles load priority in combination with dual tariff." alt="" coords="463,161,651,201"/>
<area shape="rect" href="main_8cpp.html#a9b9428fd01019319970f27b88bb1cf33" title="Rotates the load priorities." alt="" coords="699,196,828,221"/>
<area shape="rect" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output." alt="" coords="876,196,1007,221"/>
<area shape="rect" href="utils__pins_8h.html#a23ed26b879b65f5ddf07facc1e4b18bc" title="Set the specified bit to 1." alt="" coords="523,283,590,308"/>
<area shape="rect" href="utils__oled_8h.html#a3a5f8feefdddd371b3c454e2e2925f7f" title=" " alt="" coords="529,332,584,357"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a1d65183fd2d4da02833f68fd000b4761_icgraph.png" border="0" usemap="#amain_8cpp_a1d65183fd2d4da02833f68fd000b4761_icgraph" alt=""/></div>
<map name="amain_8cpp_a1d65183fd2d4da02833f68fd000b4761_icgraph" id="amain_8cpp_a1d65183fd2d4da02833f68fd000b4761_icgraph">
<area shape="rect" title="Handles tasks that need to be executed every second." alt="" coords="104,5,275,31"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
</map>
</div>

</div>
</div>
<a id="afe461d27b9c48d5921c00d521181f12f" name="afe461d27b9c48d5921c00d521181f12f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe461d27b9c48d5921c00d521181f12f">&#9670;&#160;</a></span>loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main processor loop. </p>
<p>This function is the main execution loop of the program. It handles periodic tasks, including refreshing the display, managing load priorities, processing data for logging, and sending results. The loop is designed to handle non-time-critical tasks, as all time-sensitive operations are performed within the Interrupt Service Routine (ISR).</p>
<p>Key operations include:</p><ul>
<li>Incrementing timers for periodic tasks.</li>
<li>Refreshing the display at a defined interval.</li>
<li>Managing energy diversion and load priorities.</li>
<li>Processing accumulated data for logging purposes.</li>
<li>Sending results to external systems.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The loop relies on several global variables and flags, such as <code>b_newCycle</code>, <code>b_datalogEventPending</code>, and <code>absenceOfDivertedEnergyCount</code>. It also uses compile-time constants like <code>SUPPLY_FREQUENCY</code> and <code>UPDATE_PERIOD_FOR_DISPLAYED_DATA</code>.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="main_8cpp.html#a1d65183fd2d4da02833f68fd000b4761" title="Handles tasks that need to be executed every second.">handlePerSecondTasks</a> </dd>
<dd>
<a class="el" href="main_8cpp.html#a288869292fd78ce525e6cb97a430ed02" title="Performs calculations on data for logging purposes.">processCalculationsForLogging</a> </dd>
<dd>
<a class="el" href="main_8cpp.html#aac4a0e0b4ad49cbbab8b2626204f9492" title="Updates the temperature readings and sends a new request for the next cycle.">updateTemperature</a> </dd>
<dd>
<a class="el" href="group__GeneralProcessing.html#gade56d6fce22a518b8feff1a150461f94" title="Prints or sends telemetry data logs based on the selected output format.">sendResults</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00492">492</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_afe461d27b9c48d5921c00d521181f12f_cgraph.png" border="0" usemap="#amain_8cpp_afe461d27b9c48d5921c00d521181f12f_cgraph" alt=""/></div>
<map name="amain_8cpp_afe461d27b9c48d5921c00d521181f12f_cgraph" id="amain_8cpp_afe461d27b9c48d5921c00d521181f12f_cgraph">
<area shape="rect" title="Main processor loop." alt="" coords="5,484,56,509"/>
<area shape="rect" href="group__OLEDDisplay.html#gafaa5f070126ac5184a648b484e7cf276" title="Clear the display." alt="" coords="164,5,267,31"/>
<area shape="rect" href="group__SegDisplay.html#ga01d09f2f19407b01775ed4b2a24b562a" title="Configures the value for display on a 7&#45;segment display." alt="" coords="122,459,309,484"/>
<area shape="rect" href="main_8cpp.html#a1d65183fd2d4da02833f68fd000b4761" title="Handles tasks that need to be executed every second." alt="" coords="130,267,301,292"/>
<area shape="rect" href="main_8cpp.html#a288869292fd78ce525e6cb97a430ed02" title="Performs calculations on data for logging purposes." alt="" coords="104,508,327,533"/>
<area shape="rect" href="group__GeneralProcessing.html#gade56d6fce22a518b8feff1a150461f94" title="Prints or sends telemetry data logs based on the selected output format." alt="" coords="165,557,266,583"/>
<area shape="rect" href="classRelayEngine.html#a2c8796258ac6cd4006a55c236c383287" title="Update the sliding average." alt="" coords="137,607,293,647"/>
<area shape="rect" href="group__OLEDDisplay.html#gaf39aee6f9a448b67c84a828071a39f71" title="Update the OLED display with the given value." alt="" coords="164,109,267,135"/>
<area shape="rect" href="main_8cpp.html#aac4a0e0b4ad49cbbab8b2626204f9492" title="Updates the temperature readings and sends a new request for the next cycle." alt="" coords="141,672,290,697"/>
<area shape="rect" href="utils__oled_8h.html#a3a5f8feefdddd371b3c454e2e2925f7f" title=" " alt="" coords="682,28,737,53"/>
<area shape="rect" href="FastDivision_8cpp.html#a23623280f6a9bc988eea84e057769267" title=" " alt="" coords="427,459,513,484"/>
<area shape="rect" href="FastDivision_8cpp.html#a8533c8b2efd068df7dd1b2e4d65b7ced" title=" " alt="" coords="437,508,503,533"/>
<area shape="rect" href="main_8cpp.html#a31f3d562faae6b598324b56299d74f7d" title="Checks and updates the diversion state." alt="" coords="630,129,789,155"/>
<area shape="rect" href="main_8cpp.html#a5157f7f79cf8c75c2d7b41d8ed47a7ef" title="Forces all loads to full power." alt="" coords="650,179,769,204"/>
<area shape="rect" href="classRelayEngine.html#a4f831b566b2da140a17333ab6a39e5dc" title="Increment the duration&#39;s state of each relay." alt="" coords="375,295,565,320"/>
<area shape="rect" href="classRelayEngine.html#a2891986bc989d9c35301711f674bc523" title="Proceed all relays in increasing order (surplus) or decreasing order (import)." alt="" coords="389,345,551,385"/>
<area shape="rect" href="main_8cpp.html#aa0f1d282805a9e6027f2a84720d60d0b" title="Handles load priority rotation and overriding logic." alt="" coords="376,230,564,270"/>
<area shape="rect" href="utils__pins_8h.html#aaec5db9d46ba784c4f16046e6deb6977" title="Toggle the specified pin." alt="" coords="429,409,511,435"/>
<area shape="rect" href="group__OLEDDisplay.html#ga1c38ae281a8a132599b5619660e7d306" title="Update the watchdog on the display." alt="" coords="405,79,535,104"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="909,204,1006,229"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="1137,204,1212,229"/>
<area shape="rect" href="main_8cpp.html#a518d4266a5d9285d29e65616eccd2277" title="Handles load priority in combination with dual tariff." alt="" coords="615,279,803,319"/>
<area shape="rect" href="main_8cpp.html#a9b9428fd01019319970f27b88bb1cf33" title="Rotates the load priorities." alt="" coords="893,315,1022,340"/>
<area shape="rect" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output." alt="" coords="1109,315,1240,340"/>
<area shape="rect" href="utils__pins_8h.html#a23ed26b879b65f5ddf07facc1e4b18bc" title="Set the specified bit to 1." alt="" coords="676,409,743,435"/>
<area shape="rect" href="group__Telemetry.html#ga988b25d4a6361b7cc751a212af170665" title="Write telemetry data to Serial in EmonCMS format." alt="" coords="401,557,539,583"/>
<area shape="rect" href="group__Telemetry.html#gae46d07fd4694c49e10360b5d79163443" title="Prints data logs to the Serial output in text format." alt="" coords="402,607,538,632"/>
<area shape="rect" href="utils_8h.html#a5072aae7cb8a3f575605b65c6be56329" title="Sends telemetry data using the TeleInfo class." alt="" coords="395,656,545,681"/>
<area shape="rect" href="classRelayEngine.html#a2c586921b020480449159786461195aa" title="Get the current average." alt="" coords="613,557,805,583"/>
<area shape="rect" href="classTeleInfo.html#a37b1447161869bf3ecc2faed134b7eee" title="Finalizes the frame by adding the end character and sending the buffer over Serial." alt="" coords="636,607,783,632"/>
<area shape="rect" href="classRelayEngine.html#a981b20422ed19d2aa87d042c583173ee" title="Get the relay object." alt="" coords="623,656,795,681"/>
<area shape="rect" href="classRelayEngine.html#a1ed9500ebf4f6d7afb519c377fab42d3" title="Get the number of relays." alt="" coords="627,705,792,731"/>
<area shape="rect" href="classTeleInfo.html#a4f418a8ad0164f7b10956c9186cdb345" title="Sends a telemetry value as an integer." alt="" coords="653,755,765,780"/>
<area shape="rect" href="classTeleInfo.html#ac3c9628b79d8f92c3d80dfdda4078e66" title="Initializes a new frame by resetting the buffer and adding the start character." alt="" coords="633,804,785,829"/>
<area shape="rect" href="classTeleInfo.html#a1f42b9e6aa9c3169b3ec469149e693a1" title="Calculates the checksum for a portion of the buffer." alt="" coords="853,729,1061,755"/>
<area shape="rect" href="classTeleInfo.html#aa3553828cf429c6a22eec47c1b4e0458" title="Writes a tag to the buffer." alt="" coords="889,779,1025,804"/>
</map>
</div>

</div>
</div>
<a id="aa0f1d282805a9e6027f2a84720d60d0b" name="aa0f1d282805a9e6027f2a84720d60d0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0f1d282805a9e6027f2a84720d60d0b">&#9670;&#160;</a></span>proceedLoadPrioritiesAndOverriding()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool proceedLoadPrioritiesAndOverriding </td>
          <td>(</td>
          <td class="paramtype">const int16_t&#160;</td>
          <td class="paramname"><em>currentTemperature_x100</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles load priority rotation and overriding logic. </p>
<p>This function manages the load priorities and overrides based on the current system state. Since the system does not have access to a clock, it detects the start of the off-peak period using the main energy meter. When the off-peak period starts, the function rotates the load priorities for the next day. It also supports dual tariff systems, rotation after a specified time, and manual overrides using a force pin. The function detects transitions between off-peak and peak periods and triggers load priority rotations accordingly.</p>
<p>Key operations include:</p><ul>
<li>Detecting off-peak and peak period transitions.</li>
<li>Rotating load priorities automatically or based on user input.</li>
<li>Managing load overrides using a force pin.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">currentTemperature_x100</td><td>The current temperature multiplied by 100 (e.g., 25.00°C is represented as 2500). Used for temperature-based load override logic.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the off-peak tariff is active. </dd>
<dd>
false if the on-peak tariff is active.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function relies on several compile-time constants and global variables, such as <code>DUAL_TARIFF</code>, <code>EMONESP_CONTROL</code>, <code>PRIORITY_ROTATION</code>, and <code>OVERRIDE_PIN_PRESENT</code>.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="main_8cpp.html#a518d4266a5d9285d29e65616eccd2277" title="Handles load priority in combination with dual tariff.">proceedLoadPrioritiesAndOverridingDualTariff</a> </dd>
<dd>
<a class="el" href="main_8cpp.html#a9b9428fd01019319970f27b88bb1cf33" title="Rotates the load priorities.">proceedRotation</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00216">216</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_aa0f1d282805a9e6027f2a84720d60d0b_cgraph.png" border="0" usemap="#amain_8cpp_aa0f1d282805a9e6027f2a84720d60d0b_cgraph" alt=""/></div>
<map name="amain_8cpp_aa0f1d282805a9e6027f2a84720d60d0b_cgraph" id="amain_8cpp_aa0f1d282805a9e6027f2a84720d60d0b_cgraph">
<area shape="rect" title="Handles load priority rotation and overriding logic." alt="" coords="5,25,193,65"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="493,5,591,31"/>
<area shape="rect" href="main_8cpp.html#a518d4266a5d9285d29e65616eccd2277" title="Handles load priority in combination with dual tariff." alt="" coords="241,25,429,65"/>
<area shape="rect" href="main_8cpp.html#a9b9428fd01019319970f27b88bb1cf33" title="Rotates the load priorities." alt="" coords="477,59,607,84"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="683,5,757,31"/>
<area shape="rect" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output." alt="" coords="655,59,785,84"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_aa0f1d282805a9e6027f2a84720d60d0b_icgraph.png" border="0" usemap="#amain_8cpp_aa0f1d282805a9e6027f2a84720d60d0b_icgraph" alt=""/></div>
<map name="amain_8cpp_aa0f1d282805a9e6027f2a84720d60d0b_icgraph" id="amain_8cpp_aa0f1d282805a9e6027f2a84720d60d0b_icgraph">
<area shape="rect" title="Handles load priority rotation and overriding logic." alt="" coords="323,5,511,45"/>
<area shape="rect" href="main_8cpp.html#a1d65183fd2d4da02833f68fd000b4761" title="Handles tasks that need to be executed every second." alt="" coords="104,13,275,38"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,13,56,38"/>
</map>
</div>

</div>
</div>
<a id="a518d4266a5d9285d29e65616eccd2277" name="a518d4266a5d9285d29e65616eccd2277"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a518d4266a5d9285d29e65616eccd2277">&#9670;&#160;</a></span>proceedLoadPrioritiesAndOverridingDualTariff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool proceedLoadPrioritiesAndOverridingDualTariff </td>
          <td>(</td>
          <td class="paramtype">const int16_t&#160;</td>
          <td class="paramname"><em>currentTemperature_x100</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles load priority in combination with dual tariff. </p>
<p>This function manages load priorities and overrides during dual tariff operation. It detects transitions between off-peak and peak periods using the state of the dual tariff pin. During the off-peak period, it rotates load priorities (if enabled) and manages load overrides based on the elapsed time and temperature thresholds. At the end of the off-peak period, it resets the state and logs the transition.</p>
<p>Key operations include:</p><ul>
<li>Detecting the start and end of off-peak periods.</li>
<li>Rotating load priorities automatically during off-peak periods.</li>
<li>Managing load overrides based on elapsed time and temperature thresholds.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">currentTemperature_x100</td><td>The current temperature multiplied by 100 (e.g., 25.00°C is represented as 2500). Used for temperature-based load override logic.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the high tariff (on-peak period) is active. </dd>
<dd>
false if the low tariff (off-peak period) is active.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function relies on several compile-time constants and global variables, such as <code>PRIORITY_ROTATION</code>, <code>NO_OF_DUMPLOADS</code>, and <code>rg_OffsetForce</code>.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="main_8cpp.html#a9b9428fd01019319970f27b88bb1cf33" title="Rotates the load priorities.">proceedRotation</a> </dd>
<dd>
<a class="el" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State.">getPinState</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00142">142</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a518d4266a5d9285d29e65616eccd2277_cgraph.png" border="0" usemap="#amain_8cpp_a518d4266a5d9285d29e65616eccd2277_cgraph" alt=""/></div>
<map name="amain_8cpp_a518d4266a5d9285d29e65616eccd2277_cgraph" id="amain_8cpp_a518d4266a5d9285d29e65616eccd2277_cgraph">
<area shape="rect" title="Handles load priority in combination with dual tariff." alt="" coords="5,23,193,63"/>
<area shape="rect" href="utils__pins_8h.html#a410a7bdd300104398ce91797bd936cdb" title="Get the Pin State." alt="" coords="257,5,355,31"/>
<area shape="rect" href="main_8cpp.html#a9b9428fd01019319970f27b88bb1cf33" title="Rotates the load priorities." alt="" coords="241,55,371,80"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="447,5,521,31"/>
<area shape="rect" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output." alt="" coords="419,55,549,80"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a518d4266a5d9285d29e65616eccd2277_icgraph.png" border="0" usemap="#amain_8cpp_a518d4266a5d9285d29e65616eccd2277_icgraph" alt=""/></div>
<map name="amain_8cpp_a518d4266a5d9285d29e65616eccd2277_icgraph" id="amain_8cpp_a518d4266a5d9285d29e65616eccd2277_icgraph">
<area shape="rect" title="Handles load priority in combination with dual tariff." alt="" coords="559,5,747,45"/>
<area shape="rect" href="main_8cpp.html#aa0f1d282805a9e6027f2a84720d60d0b" title="Handles load priority rotation and overriding logic." alt="" coords="323,5,511,45"/>
<area shape="rect" href="main_8cpp.html#a1d65183fd2d4da02833f68fd000b4761" title="Handles tasks that need to be executed every second." alt="" coords="104,13,275,38"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,13,56,38"/>
</map>
</div>

</div>
</div>
<a id="a9b9428fd01019319970f27b88bb1cf33" name="a9b9428fd01019319970f27b88bb1cf33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b9428fd01019319970f27b88bb1cf33">&#9670;&#160;</a></span>proceedRotation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void proceedRotation </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Rotates the load priorities. </p>
<p>This function triggers a reordering of load priorities. It sets a flag to indicate that the priorities need to be rotated and waits until the rotation is completed within the Interrupt Service Routine (ISR). Once the rotation is done, it logs the updated load priorities for debugging or monitoring purposes.</p>
<p>Key operations include:</p><ul>
<li>Setting the <code>b_reOrderLoads</code> flag to initiate priority rotation.</li>
<li>Waiting for the ISR to complete the rotation.</li>
<li>Logging the updated load priorities.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>This function uses a delay to wait for the ISR to complete the rotation. Ensure that the delay duration is appropriate for the system's timing requirements.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output.">logLoadPriorities</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00102">102</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a9b9428fd01019319970f27b88bb1cf33_cgraph.png" border="0" usemap="#amain_8cpp_a9b9428fd01019319970f27b88bb1cf33_cgraph" alt=""/></div>
<map name="amain_8cpp_a9b9428fd01019319970f27b88bb1cf33_cgraph" id="amain_8cpp_a9b9428fd01019319970f27b88bb1cf33_cgraph">
<area shape="rect" title="Rotates the load priorities." alt="" coords="5,5,135,31"/>
<area shape="rect" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output." alt="" coords="183,5,313,31"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a9b9428fd01019319970f27b88bb1cf33_icgraph.png" border="0" usemap="#amain_8cpp_a9b9428fd01019319970f27b88bb1cf33_icgraph" alt=""/></div>
<map name="amain_8cpp_a9b9428fd01019319970f27b88bb1cf33_icgraph" id="amain_8cpp_a9b9428fd01019319970f27b88bb1cf33_icgraph">
<area shape="rect" title="Rotates the load priorities." alt="" coords="795,13,924,38"/>
<area shape="rect" href="main_8cpp.html#aa0f1d282805a9e6027f2a84720d60d0b" title="Handles load priority rotation and overriding logic." alt="" coords="323,5,511,45"/>
<area shape="rect" href="main_8cpp.html#a518d4266a5d9285d29e65616eccd2277" title="Handles load priority in combination with dual tariff." alt="" coords="559,33,747,73"/>
<area shape="rect" href="main_8cpp.html#a1d65183fd2d4da02833f68fd000b4761" title="Handles tasks that need to be executed every second." alt="" coords="104,13,275,38"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,13,56,38"/>
</map>
</div>

</div>
</div>
<a id="a288869292fd78ce525e6cb97a430ed02" name="a288869292fd78ce525e6cb97a430ed02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a288869292fd78ce525e6cb97a430ed02">&#9670;&#160;</a></span>processCalculationsForLogging()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void processCalculationsForLogging </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs calculations on data for logging purposes. </p>
<p>This function processes accumulated data over a logging period to calculate key metrics such as power grid usage, diverted power, and voltage. These calculations are based on the number of sample sets collected during the logging period and calibration constants.</p>
<p>The function also adjusts the calculated voltage based on the logging period duration (e.g., for periods longer than 10 seconds, a scaling factor is applied).</p>
<dl class="section note"><dt>Note</dt><dd>This function relies on global variables such as <code>copyOf_sumP_grid_overDL_Period</code>, <code>copyOf_sampleSetsDuringThisDatalogPeriod</code>, and <code>f_voltageCal</code>.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__GeneralProcessing.html#gade56d6fce22a518b8feff1a150461f94" title="Prints or sends telemetry data logs based on the selected output format.">sendResults</a> </dd>
<dd>
<a class="el" href="main_8cpp.html#aac4a0e0b4ad49cbbab8b2626204f9492" title="Updates the temperature readings and sends a new request for the next cycle.">updateTemperature</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00349">349</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a288869292fd78ce525e6cb97a430ed02_icgraph.png" border="0" usemap="#amain_8cpp_a288869292fd78ce525e6cb97a430ed02_icgraph" alt=""/></div>
<map name="amain_8cpp_a288869292fd78ce525e6cb97a430ed02_icgraph" id="amain_8cpp_a288869292fd78ce525e6cb97a430ed02_icgraph">
<area shape="rect" title="Performs calculations on data for logging purposes." alt="" coords="104,5,327,31"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
</map>
</div>

</div>
</div>
<a id="a4fc01d736fe50cf5b977f755b675f11d" name="a4fc01d736fe50cf5b977f755b675f11d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fc01d736fe50cf5b977f755b675f11d">&#9670;&#160;</a></span>setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called once during startup. </p>
<p>This function initializes various components and settings required for the program to run. It sets up the serial communication, initializes the display, configures optional pins, and ensures all loads are turned off at startup. Additionally, it logs the load priorities and initializes temperature sensors if present.</p>
<p>Key operations include:</p><ul>
<li>Delaying to allow time for the Serial monitor to open.</li>
<li>Initializing the Serial interface and debug port.</li>
<li>Setting up the OLED display and initializing it.</li>
<li>Configuring optional pins and logging load priorities.</li>
<li>Initializing temperature sensors if the feature is enabled.</li>
<li>Printing the available free RAM for debugging purposes.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>This function is executed only once at the beginning of the program.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Initialization.html#gaa45f069fe76674a03f3dd560dd00b1ee" title="Print the configuration during startup.">printConfiguration</a> </dd>
<dd>
<a class="el" href="group__OLEDDisplay.html#ga513f8a3bd4cc3304364bb4e550d576b9" title="Setup the OLED display.">setupOLED</a> </dd>
<dd>
<a class="el" href="group__SegDisplay.html#ga3533a6f04780d5ed82d704bf39cebb69" title="Initializes the display for hardware-driven 7-segment displays.">initializeDisplay</a> </dd>
<dd>
<a class="el" href="group__Initialization.html#gadeeaa08a0a50d8535fdf2c8a92d4aebc" title="Initializes the processing engine, including ports, load states, and ADC setup.">initializeProcessing</a> </dd>
<dd>
<a class="el" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output.">logLoadPriorities</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00390">390</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_a4fc01d736fe50cf5b977f755b675f11d_cgraph.png" border="0" usemap="#amain_8cpp_a4fc01d736fe50cf5b977f755b675f11d_cgraph" alt=""/></div>
<map name="amain_8cpp_a4fc01d736fe50cf5b977f755b675f11d_cgraph" id="amain_8cpp_a4fc01d736fe50cf5b977f755b675f11d_cgraph">
<area shape="rect" title="Called once during startup." alt="" coords="5,180,64,205"/>
<area shape="rect" href="utils_8h.html#aac7b29dc45caaaca67299571f6a2dcc0" title="Get the available RAM during setup." alt="" coords="142,55,221,80"/>
<area shape="rect" href="group__SegDisplay.html#ga3533a6f04780d5ed82d704bf39cebb69" title="Initializes the display for hardware&#45;driven 7&#45;segment displays." alt="" coords="118,104,245,129"/>
<area shape="rect" href="group__Initialization.html#gadeeaa08a0a50d8535fdf2c8a92d4aebc" title="Initializes the processing engine, including ports, load states, and ADC setup." alt="" coords="603,207,751,232"/>
<area shape="rect" href="group__GeneralProcessing.html#gae473b1c0d80fe056d1fab9bdee38aca1" title="Prints the load priorities to the Serial output." alt="" coords="116,205,247,231"/>
<area shape="rect" href="group__Initialization.html#gaa45f069fe76674a03f3dd560dd00b1ee" title="Print the configuration during startup." alt="" coords="112,255,251,280"/>
<area shape="rect" href="group__OLEDDisplay.html#ga513f8a3bd4cc3304364bb4e550d576b9" title="Setup the OLED display." alt="" coords="135,304,228,329"/>
<area shape="rect" href="group__SegDisplay.html#gada41f61abba371bab816bae257291f92" title="Initializes the display for hardware&#45;driven 7&#45;segment displays." alt="" coords="351,55,502,80"/>
<area shape="rect" href="group__SegDisplay.html#ga41e6969691858ccbfcc03d15d9008c63" title="Initializes the display for software&#45;driven 7&#45;segment displays." alt="" coords="353,104,501,129"/>
<area shape="rect" href="utils__pins_8h.html#a85a0c8419c44c8bea7565ae9b4a782a7" title="Set the Pin state for the specified pin." alt="" coords="629,55,725,80"/>
<area shape="rect" href="utils__pins_8h.html#ada7e18750d04838130ee63030dcf185d" title="Set the Pin state to OFF for the specified pin." alt="" coords="834,5,922,31"/>
<area shape="rect" href="utils__pins_8h.html#ac55bbc1bc996c72b6c33525fd84b45e6" title="Set the Pin state to ON for the specified pin." alt="" coords="837,55,919,80"/>
<area shape="rect" href="utils__pins_8h.html#aeae4199ba44e9e5de9d228a6b6a8133e" title="Clear the specified bit." alt="" coords="1052,56,1131,81"/>
<area shape="rect" href="utils__pins_8h.html#a23ed26b879b65f5ddf07facc1e4b18bc" title="Set the specified bit to 1." alt="" coords="1058,183,1125,208"/>
<area shape="rect" href="group__Initialization.html#ga8995e5745b217d64477574abf086acc7" title="Retrieves the input pins configuration." alt="" coords="827,207,929,232"/>
<area shape="rect" href="group__Initialization.html#gac599ad38730b3cb0276687ba6cbfaf1e" title="Retrieves the output pins configuration." alt="" coords="821,305,935,331"/>
<area shape="rect" href="utils__pins_8h.html#ac106ac6266d5d7a5328ea0c63778a873" title="Set the pins as INPUT_PULLUP." alt="" coords="799,256,957,281"/>
<area shape="rect" href="utils__pins_8h.html#ad448cf4026a22a8190ea178a02702b2e" title="Set the pins as OUTPUT." alt="" coords="813,355,943,380"/>
<area shape="rect" href="utils__pins_8h.html#abaa54130a12679d0dcc0e7578e0e4d37" title="Read the specified bit." alt="" coords="1054,232,1129,257"/>
<area shape="rect" href="classRelayEngine.html#a981b20422ed19d2aa87d042c583173ee" title="Get the relay object." alt="" coords="1005,281,1177,307"/>
<area shape="rect" href="classRelayEngine.html#a1ed9500ebf4f6d7afb519c377fab42d3" title="Get the number of relays." alt="" coords="1009,331,1174,356"/>
<area shape="rect" href="processing_8cpp.html#aa2b3b1d496e37e5f29af6a766743dc8b" title="Print the settings used for the selected output mode." alt="" coords="299,253,555,279"/>
<area shape="rect" href="utils__oled_8h.html#a3a5f8feefdddd371b3c454e2e2925f7f" title=" " alt="" coords="649,304,704,329"/>
<area shape="rect" href="group__OLEDDisplay.html#ga2303391296efb5abb3f851b8bda64855" title="Draw the xbm on the OLED display." alt="" coords="362,355,491,380"/>
<area shape="rect" href="group__OLEDDisplay.html#gaa57d8826eabcc4fdd9ff420cf69038ce" title="Get the tile from xbm object." alt="" coords="604,355,749,380"/>
</map>
</div>

</div>
</div>
<a id="aac4a0e0b4ad49cbbab8b2626204f9492" name="aac4a0e0b4ad49cbbab8b2626204f9492"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac4a0e0b4ad49cbbab8b2626204f9492">&#9670;&#160;</a></span>updateTemperature()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void updateTemperature </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates the temperature readings and sends a new request for the next cycle. </p>
<p>This function reads the temperature values from the sensors, validates them, and updates the global temperature data. If a temperature reading is invalid (e.g., disconnected sensor or out-of-range value), it is replaced with a default value (<code>DEVICE_DISCONNECTED_RAW</code>). After processing the current readings, the function sends a new request to the sensors to prepare for the next cycle.</p>
<p>Key operations include:</p><ul>
<li>Reading temperature values from all sensors.</li>
<li>Validating the temperature readings.</li>
<li>Updating the global temperature data structure.</li>
<li>Sending a new request to the sensors for the next cycle.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>This function is only executed if the <code>TEMP_SENSOR_PRESENT</code> compile-time constant is defined.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="config_8h.html#a412759f741ec4a38f90e75adfe997b58">temperatureSensing</a> </dd>
<dd>
<a class="el" href="constants_8h.html#a32edf43fb1167432fcfdfdf60351ca83">DEVICE_DISCONNECTED_RAW</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="main_8cpp_source.html#l00311">311</a> of file <a class="el" href="main_8cpp_source.html">main.cpp</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp_aac4a0e0b4ad49cbbab8b2626204f9492_icgraph.png" border="0" usemap="#amain_8cpp_aac4a0e0b4ad49cbbab8b2626204f9492_icgraph" alt=""/></div>
<map name="amain_8cpp_aac4a0e0b4ad49cbbab8b2626204f9492_icgraph" id="amain_8cpp_aac4a0e0b4ad49cbbab8b2626204f9492_icgraph">
<area shape="rect" title="Updates the temperature readings and sends a new request for the next cycle." alt="" coords="104,5,253,31"/>
<area shape="rect" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f" title="Main processor loop." alt="" coords="5,5,56,31"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
